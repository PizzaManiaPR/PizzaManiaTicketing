<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PizzaManía - Pedido Kiosko</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.4.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            padding: 20px;
            background: #fff8f0;
        }
        h2 {
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 700;
            color: #c62828;
        }
        .btn-option {
            margin: 5px;
            min-width: 120px;
            font-weight: 600;
        }
        .btn-option.selected {
            background-color: #c62828;
            color: white;
        }
        #extras .btn-option {
            min-width: 180px;
        }
        #resumen {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            box-shadow: 0 0 10px #c62828aa;
        }
        #ticket {
            white-space: pre-wrap;
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: monospace;
            max-height: 250px;
            overflow-y: auto;
        }
        .section-label {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #b71c1c;
        }
        .btn-clear {
            margin-top: 15px;
        }
        .footer-note {
            margin-top: 40px;
            font-size: 0.9rem;
            color: #999;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">PizzaManía - Pedido Kiosko</h1>

        <!-- Cliente -->
        <div class="mb-3">
            <label for="cliente" class="form-label">Nombre del cliente:</label>
            <input type="text" id="cliente" class="form-control" placeholder="Escribe el nombre" />
        </div>

        <!-- Tamaño Pizza -->
        <div>
            <div class="section-label">Tamaño de pizza:</div>
            <div id="tamanio" class="d-flex flex-wrap">
                <button type="button" class="btn btn-outline-danger btn-option" data-value="Personal" data-price="60">Personal $60</button>
                <button type="button" class="btn btn-outline-danger btn-option" data-value="Chica" data-price="100">Chica $100</button>
                <button type="button" class="btn btn-outline-danger btn-option" data-value="Mediana" data-price="140">Mediana $140</button>
            </div>
        </div>

        <!-- Especialidad Pizza -->
        <div>
            <div class="section-label">Especialidad de pizza:</div>
            <div id="especialidad_pizza" class="d-flex flex-wrap">
                <button type="button" class="btn btn-outline-primary btn-option" data-value="Pepperoni" data-price="0">Pepperoni</button>
                <button type="button" class="btn btn-outline-primary btn-option" data-value="Hawaiana" data-price="0">Hawaiana</button>
                <button type="button" class="btn btn-outline-primary btn-option" data-value="Carnes Frías" data-price="0">Carnes Frías</button>
                <button type="button" class="btn btn-outline-primary btn-option" data-value="Vegetariana" data-price="0">Vegetariana</button>
            </div>
        </div>

        <!-- Hamburguesas -->
        <div>
            <div class="section-label">Hamburguesas (cantidad):</div>
            <div id="hamburguesas" class="d-flex flex-wrap gap-3">
                <div>
                    <div>Clásica ($70 c/u)</div>
                    <input type="number" min="0" value="0" class="form-control cantidad-hamburguesa" data-price="70" data-nombre="Clásica" style="width: 70px" />
                </div>
                <div>
                    <div>Norteña ($75 c/u)</div>
                    <input type="number" min="0" value="0" class="form-control cantidad-hamburguesa" data-price="75" data-nombre="Norteña" style="width: 70px" />
                </div>
                <div>
                    <div>Hawaiana ($80 c/u)</div>
                    <input type="number" min="0" value="0" class="form-control cantidad-hamburguesa" data-price="80" data-nombre="Hawaiana" style="width: 70px" />
                </div>
                <div>
                    <div>Doble Carne ($95 c/u)</div>
                    <input type="number" min="0" value="0" class="form-control cantidad-hamburguesa" data-price="95" data-nombre="Doble Carne" style="width: 70px" />
                </div>
            </div>
        </div>

        <!-- Hot Dogs -->
        <div>
            <div class="section-label">Hot Dogs (cantidad):</div>
            <div id="hotdogs" class="d-flex flex-wrap gap-3">
                <div>
                    <div>Clásico ($50 c/u)</div>
                    <input type="number" min="0" value="0" class="form-control cantidad-hotdog" data-price="50" data-nombre="Clásico" style="width: 70px" />
                </div>
                <div>
                    <div>Salchichón ($55 c/u)</div>
                    <input type="number" min="0" value="0" class="form-control cantidad-hotdog" data-price="55" data-nombre="Salchichón" style="width: 70px" />
                </div>
                <div>
                    <div>Pepperoni ($60 c/u)</div>
                    <input type="number" min="0" value="0" class="form-control cantidad-hotdog" data-price="60" data-nombre="Pepperoni" style="width: 70px" />
                </div>
                <div>
                    <div>Hawaiano ($65 c/u)</div>
                    <input type="number" min="0" value="0" class="form-control cantidad-hotdog" data-price="65" data-nombre="Hawaiano" style="width: 70px" />
                </div>
            </div>
        </div>

        <!-- Extras -->
        <div>
            <div class="section-label">Extras (elige máximo 2):</div>
            <div id="extras" class="d-flex flex-wrap">
                <button type="button" class="btn btn-outline-success btn-option" data-value="Papas a la francesa" data-price="35">Papas a la francesa $35</button>
                <button type="button" class="btn btn-outline-success btn-option" data-value="Papas en gajo" data-price="40">Papas en gajo $40</button>
                <button type="button" class="btn btn-outline-success btn-option" data-value="Refresco" data-price="30">Refresco $30</button>
            </div>
        </div>

        <!-- Método de pago -->
        <div class="mb-3 mt-3">
            <label for="metodo_pago" class="form-label">Método de pago:</label>
            <div id="metodo_pago" class="d-flex flex-wrap">
                <button type="button" class="btn btn-outline-dark btn-option" data-value="Efectivo">Efectivo</button>
                <button type="button" class="btn btn-outline-dark btn-option" data-value="Tarjeta">Tarjeta</button>
            </div>
        </div>

        <!-- Total -->
        <div id="resumen">
            <h3>Total: $<span id="total">0</span></h3>
            <button id="finalizar" class="btn btn-danger btn-lg w-100">Finalizar Pedido e Imprimir</button>
            <button id="limpiar" class="btn btn-secondary btn-lg w-100 mt-2">Limpiar Pedido</button>
            <pre id="ticket"></pre>
        </div>
    </div>

    <!-- Bootstrap JS Bundle (Popper + Bootstrap JS) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Variables globales
        let pedido = {
            cliente: '',
            tamanio: null,
            especialidad_pizza: null,
            hamburguesas: {},
            hotdogs: {},
            extras: [],
            pago: null,
            hora: null,
        };

        // Limpiar selección de botones en contenedor
        function limpiarSeleccion(contenedor, multiple = false) {
            const buttons = contenedor.querySelectorAll('.btn-option');
            buttons.forEach(btn => {
                if (!multiple) btn.classList.remove('selected');
                else btn.classList.remove('selected'); // Para extras que son toggle
            });
        }

        // Toggle selección para extras
        function toggleSeleccion(btn) {
            btn.classList.toggle('selected');
        }

        // Actualiza total y muestra resumen
        function actualizarTotal() {
            let total = 0;

            // Suma tamaño pizza
            if (pedido.tamanio) {
                const btn = document.querySelector(`#tamanio .btn-option.selected`);
                total += parseInt(btn.dataset.price);
            }

            // Hamburguesas cantidad * precio
            for (const [nombre, datos] of Object.entries(pedido.hamburguesas)) {
                total += datos.cantidad * datos.precio;
            }

            // Hotdogs cantidad * precio
            for (const [nombre, datos] of Object.entries(pedido.hotdogs)) {
                total += datos.cantidad * datos.precio;
            }

            // Extras precios
            pedido.extras.forEach(extra => {
                total += extra.precio;
            });

            document.getElementById('total').textContent = total;
        }

        // Genera el ticket texto
        function generarTicket() {
            const now = new Date();
            const hora = now.toLocaleString();
            pedido.hora = hora;

            let ticketTxt = 
`================================
         PizzaManía
================================
Cliente:   ${pedido.cliente}

Pedido:
  Pizza: ${pedido.tamanio ?? '-'} - ${pedido.especialidad_pizza ?? '-'}
  Hamburguesas: ${
    Object.keys(pedido.hamburguesas).length === 0 ? '-' :
    Object.entries(pedido.hamburguesas).filter(([k,v]) => v.cantidad > 0)
    .map(([k,v]) => `${v.cantidad} x ${k}`)
    .join(', ')
  }
  Hot Dogs: ${
    Object.keys(pedido.hotdogs).length === 0 ? '-' :
    Object.entries(pedido.hotdogs).filter(([k,v]) => v.cantidad > 0)
    .map(([k,v]) => `${v.cantidad} x ${k}`)
    .join(', ')
  }
  Extras: ${
    pedido.extras.length === 0 ? '-' :
    pedido.extras.map(e => e.nombre).join(', ')
  }

Pago:      ${pedido.pago ?? '-'}

Hora:      ${pedido.hora}
================================
   ¡Gracias por tu preferencia!
================================
`;

            document.getElementById('ticket').textContent = ticketTxt;
        }

        // Validar campos obligatorios
        function validarPedido() {
            if (!pedido.cliente.trim()) {
                alert('Por favor, ingresa el nombre del cliente.');
                return false;
            }
            if (!pedido.tamanio) {
                alert('Selecciona un tamaño de pizza.');
                return false;
            }
            if (!pedido.especialidad_pizza) {
                alert('Selecciona una especialidad de pizza.');
                return false;
            }
            if (!pedido.pago) {
                alert('Selecciona un método de pago.');
                return false;
            }
            // Al menos un producto
            const hamburguesasTotal = Object.values(pedido.hamburguesas).reduce((acc,v) => acc + v.cantidad, 0);
            const hotdogsTotal = Object.values(pedido.hotdogs).reduce((acc,v) => acc + v.cantidad, 0);
            const extrasTotal = pedido.extras.length;

            if (hamburguesasTotal === 0 && hotdogsTotal === 0 && extrasTotal === 0 && !pedido.tamanio) {
                alert('Debes seleccionar al menos una pizza, hamburguesa, hot dog o extra.');
                return false;
            }

            return true;
        }

        // Imprimir ticket
        function imprimirTicket() {
            const contenido = document.getElementById('ticket').textContent;
            const ventana = window.open('', '', 'width=400,height=600');
            ventana.document.write('<pre style="font-family: monospace; font-size: 14px;">' + contenido + '</pre>');
            ventana.document.close();
            ventana.focus();
            ventana.print();
            ventana.close();
        }

        // Reiniciar pedido y formulario
        function limpiarPedido() {
            pedido = {
                cliente: '',
                tamanio: null,
                especialidad_pizza: null,
                hamburguesas: {},
                hotdogs: {},
                extras: [],
                pago: null,
                hora: null,
            };
            document.getElementById('cliente').value = '';
            document.querySelectorAll('.btn-option').forEach(b => b.classList.remove('selected'));
            document.querySelectorAll('.cantidad-hamburguesa, .cantidad-hotdog').forEach(i => i.value = 0);
            document.getElementById('total').textContent = '0';
            document.getElementById('ticket').textContent = '';
        }

        // Manejo eventos botones de selección (tamaño, pizza, extras, pago)
        document.querySelectorAll('#tamanio .btn-option').forEach(btn => {
            btn.addEventListener('click', () => {
                limpiarSeleccion(document.getElementById('tamanio'));
                btn.classList.add('selected');
                pedido.tamanio = btn.dataset.value;
                actualizarTotal();
            });
        });

        document.querySelectorAll('#especialidad_pizza .btn-option').forEach(btn => {
            btn.addEventListener('click', () => {
                limpiarSeleccion(document.getElementById('especialidad_pizza'));
                btn.classList.add('selected');
                pedido.especialidad_pizza = btn.dataset.value;
            });
        });

        // Extras permiten selección múltiple max 2
        document.querySelectorAll('#extras .btn-option').forEach(btn => {
            btn.addEventListener('click', () => {
                const selected = btn.classList.contains('selected');
                const seleccionadas = document.querySelectorAll('#extras .btn-option.selected').length;

                if (!selected && seleccionadas >= 2) {
                    alert('Solo puedes seleccionar máximo 2 extras');
                    return;
                }
                btn.classList.toggle('selected');

                // Actualizar pedido.extras
                pedido.extras = Array.from(document.querySelectorAll('#extras .btn-option.selected')).map(b => ({
                    nombre: b.dataset.value,
                    precio: parseInt(b.dataset.price)
                }));

                actualizarTotal();
            });
        });

        document.querySelectorAll('#metodo_pago .btn-option').forEach(btn => {
            btn.addEventListener('click', () => {
                limpiarSeleccion(document.getElementById('metodo_pago'));
                btn.classList.add('selected');
                pedido.pago = btn.dataset.value;
            });
        });

        // Inputs cantidad hamburguesas
        document.querySelectorAll('.cantidad-hamburguesa').forEach(input => {
            input.addEventListener('input', () => {
                const nombre = input.dataset.nombre;
                const cantidad = parseInt(input.value) || 0;
                const precio = parseInt(input.dataset.price);
                if (cantidad > 0) {
                    pedido.hamburguesas[nombre] = { cantidad, precio };
                } else {
                    delete pedido.hamburguesas[nombre];
                }
                actualizarTotal();
            });
        });

        // Inputs cantidad hotdogs
        document.querySelectorAll('.cantidad-hotdog').forEach(input => {
            input.addEventListener('input', () => {
                const nombre = input.dataset.nombre;
                const cantidad = parseInt(input.value) || 0;
                const precio = parseInt(input.dataset.price);
                if (cantidad > 0) {
                    pedido.hotdogs[nombre] = { cantidad, precio };
                } else {
                    delete pedido.hotdogs[nombre];
                }
                actualizarTotal();
            });
        });

        // Cliente nombre input
        document.getElementById('cliente').addEventListener('input', (e) => {
            pedido.cliente = e.target.value;
        });

        // Finalizar pedido e imprimir
        document.getElementById('finalizar').addEventListener('click', () => {
            if (!validarPedido()) return;
            generarTicket();
            imprimirTicket();
            limpiarPedido();
        });

        // Limpiar pedido
        document.getElementById('limpiar').addEventListener('click', () => {
            limpiarPedido();
        });
    </script>
</body>
</html>
